---
title: MCP Server
description: Expose your email archive to AI assistants via MCP.
---

The MCP server operates on your **local archive**, not your live Gmail account. The AI cannot send emails, modify labels, or access your Google credentials. It can search, read, and analyze your messages, and it can stage messages for deletion, but nothing is actually deleted until you explicitly run `msgvault delete-staged` from the command line. You control when data enters the archive (via `sync-full` / `sync`) and when anything is deleted (via the explicit [deletion workflow](/usage/deletion/)). Compared to giving an AI assistant direct OAuth access to your mailbox, this is a fundamentally smaller attack surface.

## Setup

The `mcp` command starts a [Model Context Protocol](https://modelcontextprotocol.io/) (MCP) server that exposes your email archive as a set of tools. This lets AI assistants like Claude Desktop search, read, and analyze your messages directly.

### Claude Desktop Configuration

Add the following to your Claude Desktop config file:

- **macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Windows**: `%APPDATA%\Claude\claude_desktop_config.json`

```json
{
  "mcpServers": {
    "msgvault": {
      "command": "msgvault",
      "args": ["mcp"]
    }
  }
}
```

If `msgvault` is not on your PATH, use the full path to the binary. Restart Claude Desktop after saving the config.

## Available Tools

The MCP server exposes the following tools to connected AI clients:

| Tool | Description | Parameters |
|---|---|---|
| `search_messages` | Full-text search with Gmail-like query syntax | `query` (string, required), `limit` (int), `offset` (int), `account` (string) |
| `get_message` | Get full message details by ID | `id` (int) |
| `list_messages` | List messages with filters | `from` (string), `to` (string), `label` (string), `after` (string), `before` (string), `has_attachment` (bool), `limit` (int), `offset` (int), `account` (string) |
| `get_attachment` | Get attachment content by ID | `attachment_id` (int) |
| `export_attachment` | Save attachment to filesystem | `attachment_id` (int), `destination` (string) |
| `get_stats` | Archive overview statistics | â€” |
| `aggregate` | Grouped statistics (top senders, domains, labels, time series) | `group_by` (string: sender/recipient/domain/label/time), `limit` (int), `after` (string), `before` (string), `account` (string) |
| `stage_deletion` | Stage messages for deletion by query or structured filters | `query` (string), `from` (string), `domain` (string), `label` (string), `after` (string), `before` (string), `has_attachment` (bool), `account` (string) |

## Deletion Staging

The `stage_deletion` tool lets you ask an AI assistant to find and stage messages for deletion. It supports two modes:

- **Query mode**: pass a Gmail-style search string (for example `from:linkedin subject:job alert`)
- **Structured filters**: pass individual filter fields (`from`, `domain`, `label`, `after`, `before`, `has_attachment`)

You must use one mode or the other, not both in the same call. Results are capped at 100,000 messages per call.

Staging creates a deletion manifest but does not delete anything. To execute, review and run from the CLI:

```bash
# List pending deletion batches
msgvault delete-staged --list

# Execute a batch
msgvault delete-staged

# Cancel a batch
msgvault cancel-deletion <batch-id>
```

See [Deleting Email](/usage/deletion/) for the full deletion workflow.

## Example Usage with Claude

Once configured, you can ask Claude questions like:

- *"Search my email for messages from alice@example.com about the project proposal"*
- *"How many emails did I receive last month?"*
- *"Show me the top 10 senders in my archive"*
- *"Find all messages with attachments larger than 5MB"*
- *"Stage all emails from linkedin.com for deletion"*
- *"Stage promotional emails from before 2023 for deletion"*

Claude will automatically call the appropriate msgvault tools to retrieve and analyze your messages.

## CLI Flags

```bash
# Start the MCP server (stdio transport)
msgvault mcp

# Force SQL retrieval for all searches
msgvault mcp --force-sql
```

| Flag | Default | Description |
|---|---|---|
| `--force-sql` | `false` | Always use SQL retrieval instead of FTS5 |
