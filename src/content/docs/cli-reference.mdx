---
title: CLI Reference
description: Complete command reference for all msgvault commands.
---

## Global Flags

| Flag | Description |
|---|---|
| `--config` | Path to config file (default: `~/.msgvault/config.toml`) |
| `--home` | Home directory for all data (overrides `MSGVAULT_HOME`) |
| `-v`, `--verbose` | Verbose output |
| `--local` | Force local database mode when `[remote]` is configured |
| `--help` | Show help |

---

## init-db

Initialize the SQLite database.

```bash
msgvault init-db
```

---

## add-account

Add a Gmail account and authorize via OAuth.

```bash
msgvault add-account <email>
msgvault add-account <email> --headless
```

| Flag | Description |
|---|---|
| `--headless` | Show instructions for headless server setup |
| `--display-name` | Set a display name for the account |

---

## sync-full

Download all messages from a Gmail account. When called without an email argument, syncs all configured accounts.

```bash
msgvault sync-full [email] [flags]
```

| Flag | Description |
|---|---|
| `--limit N` | Maximum messages to download |
| `--after YYYY-MM-DD` | Only messages after this date |
| `--before YYYY-MM-DD` | Only messages before this date |
| `--noresume` | Ignore checkpoints, start fresh |
| `--verbose` | Detailed progress output |

---

## sync

Sync new and changed messages using Gmail History API. When called without an email argument, syncs all accounts that have completed an initial full sync.

```bash
msgvault sync [email]
```

---

## search

Search the archive with Gmail-like query syntax.

```bash
msgvault search <query> [flags]
```

| Flag | Description |
|---|---|
| `--json` | Output results as JSON |

See [Searching](/usage/searching/) for the full operator reference.

---

## tui

Launch the interactive terminal interface.

```bash
msgvault tui [flags]
```

| Flag | Description |
|---|---|
| `--account <email>` | Filter to a specific account |

---

## export-eml

Export a message as a `.eml` file.

```bash
msgvault export-eml [flags]
```

| Flag | Description |
|---|---|
| `--message-id N` | Internal database message ID |
| `--gmail-id <hex>` | Gmail message ID |
| `--output <path>` | Output file (default: stdout) |

---

## export-attachment

Export an attachment by its SHA-256 content hash.

```bash
msgvault export-attachment <content-hash> [flags]
```

| Flag | Description |
|---|---|
| `-o`, `--output <path>` | Output file path (use `-` for stdout) |
| `--base64` | Output raw base64 to stdout |
| `--json` | Output as JSON with base64-encoded data |

The `--json`, `--base64`, and `--output` flags are mutually exclusive.

See [Exporting Data](/usage/exporting/) for usage examples.

---

## export-attachments

Export all attachments from a message as individual files.

```bash
msgvault export-attachments <message-id> [flags]
```

| Flag | Description |
|---|---|
| `-o`, `--output <dir>` | Output directory (default: current directory) |

Accepts internal numeric IDs or Gmail message IDs. See [Exporting Data](/usage/exporting/) for usage examples.

---

## export-token

Export a browser-created OAuth refresh token to a remote msgvault instance.

Use this for headless deployments (NAS, cloud VM, any remote server) that cannot run a browser flow.

```bash
msgvault export-token <email> [flags]
```

| Flag | Description |
|---|---|
| `--to <url>` | Remote msgvault URL (or `MSGVAULT_REMOTE_URL`) |
| `--api-key <key>` | API key (or `MSGVAULT_REMOTE_API_KEY`) |
| `--allow-insecure` | Allow HTTP for trusted networks (for example Tailscale) |

`export-token` uploads `~/.msgvault/tokens/<email>.json` to `/api/v1/auth/token/<email>`, saves it in the remote token store, and posts account metadata to `/api/v1/accounts`.

---

## verify

Verify local archive integrity against Gmail.

```bash
msgvault verify <email> [flags]
```

| Flag | Description |
|---|---|
| `--sample-size N` | Messages to sample (default: 100) |

---

## stats

Show archive statistics.

```bash
msgvault stats
```

---

## list-senders

List top senders by message count.

```bash
msgvault list-senders [flags]
```

| Flag | Description |
|---|---|
| `--limit N` | Number of results (default: 10) |

---

## list-domains

List top sender domains by message count.

```bash
msgvault list-domains [flags]
```

| Flag | Description |
|---|---|
| `--limit N` | Number of results (default: 10) |

---

## list-labels

List all labels with message counts.

```bash
msgvault list-labels
```

---

## build-cache

Build or update the Parquet analytics cache.

```bash
msgvault build-cache [flags]
```

| Flag | Description |
|---|---|
| `--full-rebuild` | Discard existing cache and rebuild |

---

## cache-stats

Show statistics about the analytics cache.

```bash
msgvault cache-stats
```

---

## mcp

Start the Model Context Protocol server for AI assistant integration.

```bash
msgvault mcp [flags]
```

| Flag | Default | Description |
|---|---|---|
| `--force-sql` | `false` | Always use SQL retrieval instead of FTS5 |

See [MCP Server](/usage/chat/) for configuration and tool reference.

---

## serve

Start the web server with optional background sync scheduling.

```bash
msgvault serve
```

The `serve` command has no CLI flags. All configuration (port, bind address, API key, CORS, account schedules) is read from your `config.toml`. See [Web Server](/api-server/) for endpoint documentation and [Configuration](/configuration/#server) for config options.

---

## setup

Run the first-run setup wizard for OAuth and optional remote deployment.

```bash
msgvault setup
```

If configured for a remote server, this command generates `<MSGVAULT_HOME>/nas-bundle` with:

- `config.toml` ready for container deployment
- `client_secret.json`
- `docker-compose.yml`

The wizard also stores remote URL/API key in `remote` config block so `export-token` can use it without extra flags.

---

## show-message

Show full message details.

```bash
msgvault show-message <id> [flags]
```

| Flag | Description |
|---|---|
| `--json` | Output as JSON |

---

## list-accounts

List synced email accounts.

```bash
msgvault list-accounts [flags]
```

| Flag | Description |
|---|---|
| `--json` | Output as JSON |

---

## update-account

Update account settings.

```bash
msgvault update-account <email> [flags]
```

| Flag | Description |
|---|---|
| `--display-name` | Set a display name for the account |

---

## list-deletions

List pending and recent deletion batches.

```bash
msgvault list-deletions
```

---

## show-deletion

Show details of a deletion batch.

```bash
msgvault show-deletion <batch-id>
```

---

## cancel-deletion

Cancel pending or in-progress deletion batches. When called without a batch ID, lists available batches.

```bash
msgvault cancel-deletion [batch-id]
msgvault cancel-deletion --all
```

| Flag | Description |
|---|---|
| `--all` | Cancel all pending and in-progress batches |

---

## delete-staged

Execute staged deletions. This permanently deletes messages from Gmail.

```bash
msgvault delete-staged [batch-id] [flags]
```

| Flag | Description |
|---|---|
| `-y`, `--yes` | Skip confirmation prompt |
| `--dry-run` | Show what would be deleted without deleting |
| `-l`, `--list` | List staged deletion batches |
| `--account` | Filter to a specific account |

---

## repair-encoding

Fix UTF-8 encoding issues in existing messages.

```bash
msgvault repair-encoding
```

---

## update

Update msgvault to the latest version.

```bash
msgvault update [flags]
```

| Flag | Description |
|---|---|
| `--check` | Check for updates without installing |
| `-y`, `--yes` | Skip confirmation prompt |
| `-f`, `--force` | Force update even if already on the latest version |

---

## quickstart

Print a quickstart guide for AI agents.

```bash
msgvault quickstart
```
