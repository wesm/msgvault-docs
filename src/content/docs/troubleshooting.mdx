---
title: Troubleshooting
description: Common issues and solutions.
---

## OAuth Errors

### "Error 403: access_denied"

Your email isn't added as a test user. Go to **OAuth consent screen > Test users** and add your Gmail address.

### "Access blocked: This app's request is invalid"

The Gmail scope isn't configured. Verify you added `gmail.modify` scope and that Gmail API is enabled in your Google Cloud project.

### "redirect_uri_mismatch"

Wrong application type. Ensure you selected **Desktop application** when creating OAuth credentials.

### "OAuth client is missing redirect_uris"

You created a "TVs and Limited Input devices" OAuth client, which doesn't work with Gmail. Google's device code flow does not support Gmail scopes. Create a new OAuth client with **Desktop application** type instead.

### General OAuth Issues

1. Remove old tokens: `rm ~/.msgvault/tokens/you@gmail.com.json`
2. Re-add account: `msgvault add-account you@gmail.com`
3. Revoke and retry: [myaccount.google.com/permissions](https://myaccount.google.com/permissions)

## Headless Server Issues

### "No browser available"

The standard OAuth flow requires a browser. For headless servers, use the copy-token workflow:

1. Authorize on a machine with a browser: `msgvault add-account you@gmail.com`
2. Copy the token file to your server: `scp ~/.msgvault/tokens/you@gmail.com.json user@server:~/.msgvault/tokens/`
3. Register on the server: `msgvault add-account you@gmail.com`

Run `msgvault add-account you@gmail.com --headless` to see detailed instructions with the exact paths for your configuration.

### Token copied but "account not found"

After copying the token, you must run `msgvault add-account you@gmail.com` on the headless server to register the account in the database. This command detects the existing token and registers the account without opening a browser.

## Rate Limiting

If you hit Gmail API rate limits during large syncs:

1. Reduce `rate_limit_qps` in config (default: 5)
2. Use `--limit` during initial testing
3. Wait and retry. Rate limits reset over time

## Database Corruption

If the database is corrupted:

1. Back up your database: `cp ~/.msgvault/msgvault.db ~/.msgvault/msgvault.db.bak`
2. Delete and re-sync:
   ```bash
   rm ~/.msgvault/msgvault.db
   msgvault init-db
   msgvault sync-full you@gmail.com
   ```

## Interrupted Syncs

Run the same sync command again. It resumes from the last checkpoint:

```bash
msgvault sync-full you@gmail.com --after 2024-01-01 --before 2024-02-01
```

To force a fresh start:

```bash
msgvault sync-full you@gmail.com --noresume
```

## CGO / Build Errors

If you get errors about missing C compiler:

- **macOS**: Install Xcode Command Line Tools: `xcode-select --install`
- **Linux**: Install GCC: `apt install gcc` or `dnf install gcc`

CGO is required for `mattn/go-sqlite3` (FTS5 support).

## TUI Not Showing Data

If the TUI launches but shows no data:

1. Verify sync completed: `msgvault stats`
2. Rebuild the Parquet cache: `msgvault build-cache --full-rebuild`
3. Check account filter: try `msgvault tui` without `--account`
